I"»;<blockquote>
  <p>æœ€è¿‘å‡†å¤‡å¯¹é¡¹ç›®ç”Ÿæˆ Change Logï¼Œç„¶è€Œå‘ç°æäº¤æ ¼å¼ä¸ç»Ÿä¸€æ ¹æœ¬æ²¡æ³•å¤„ç†ï¼›so åæ¥å¤§å®¶çº¦å®šå¼éµå¾ª GitFlowï¼Œå¹¶ä½¿ç”¨ Angular ç¤¾åŒºè§„èŒƒçš„æäº¤æ ¼å¼ï¼ŒåŒæ—¶æ‰©å±•äº†ä¸€äº›å‰ç¼€å¦‚ hotfix ç­‰ï¼›ä½†æ˜¯æ—¶é—´é•¿äº†å‘ç°è¿˜æ˜¯æœ‰äº›æäº¤ä¸ºäº† â€œæ–¹ä¾¿â€ ä¸éµå¾ª Angular ç¤¾åŒºè§„èŒƒçš„æäº¤æ ¼å¼ï¼Œè¿™æ—¶å€™æˆ‘å”¯ä¸€èƒ½åšçš„å°±æ˜¯æƒ³åŠæ³•åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªæäº¤æ£€æµ‹ï¼›ä»¥ä¸‹è®°å½•äº† GitLab å¢åŠ è‡ªå®šä¹‰ Commit æäº¤æ ¼å¼æ£€æµ‹çš„æ–¹æ¡ˆ</p>
</blockquote>

<h2 id="ä¸€ç›¸å…³æ–‡ç« èµ„æ–™">ä¸€ã€ç›¸å…³æ–‡ç« èµ„æ–™</h2>

<p>æœ€å¼€å§‹ç”¨ Google æœç´¢åˆ°çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ GitLab çš„ Push Rules åŠŸèƒ½ï¼Œå…·ä½“æ–‡æ¡£è§ <a href="https://docs.gitlab.com/ee/push_rules/push_rules.html">è¿™é‡Œ</a>ï¼Œçœ‹å®Œäº†æˆ‘æ‰å‘ç°è¿™æ˜¯ä¼ä¸šç‰ˆç‹¬æœ‰çš„ï¼Œä½œä¸ºæ¯”è¾ƒæœ‰é€¼æ ¼(qiong)çš„æˆ‘ä»¬æ˜¯ä¸å¯èƒ½æ¥å—è¿™ç§ â€œæ²¡æŠ€æœ¯å«é‡â€ çš„æ–¹å¼çš„ï¼›åæ¥æ‰¾äº†å¥½å¤šèµ„æ–™ï¼Œå‘ç°è¿˜å¾—å€ŸåŠ© Git Hook åŠŸèƒ½ï¼Œæ–‡æ¡£è§ <a href="https://docs.gitlab.com/ee/administration/custom_hooks.html">Custom Git Hooks</a>ï¼›ç®€å•åœ°è¯´ Git Hook å°±æ˜¯åœ¨ git æ“ä½œçš„ä¸åŒé˜¶æ®µæ‰§è¡Œçš„é¢„å®šä¹‰è„šæœ¬ï¼Œ<strong>GitLab ç›®å‰ä»…æ”¯æŒ <code class="highlighter-rouge">pre-receive</code> è¿™ä¸ªé’©å­ï¼Œå½“ç„¶ä»–å¯ä»¥é“¾å¼è°ƒç”¨</strong>ï¼›æ‰€ä»¥ä¸€åˆ‡æ“ä½œå°±å¾—ä»è¿™é‡Œå…¥æ‰‹</p>

<h2 id="äºŒpre-receive-å®ç°">äºŒã€pre-receive å®ç°</h2>

<p>æŸ¥é˜…äº†ç›¸å…³èµ„æ–™å¾—å‡ºï¼Œåœ¨è¿›è¡Œ push æ—¶ï¼ŒGitLab ä¼šè°ƒç”¨è¿™ä¸ªé’©å­æ–‡ä»¶ï¼Œè¿™ä¸ªé’©å­æ–‡ä»¶å¿…é¡»æ”¾åœ¨ <code class="highlighter-rouge">/var/opt/gitlab/git-data/repositories/&lt;group&gt;/&lt;project&gt;.git/custom_hooks</code> ç›®å½•ä¸­ï¼Œå½“ç„¶å…·ä½“è·¯å¾„ä¹Ÿå¯èƒ½æ˜¯ <code class="highlighter-rouge">/home/git/repositories/&lt;group&gt;/&lt;project&gt;.git/custom_hooks</code>ï¼›<code class="highlighter-rouge">custom_hooks</code> ç›®å½•éœ€è¦è‡ªå·±åˆ›å»ºï¼Œå…·ä½“å¯ä»¥å‚é˜…æ–‡æ¡£çš„ <a href="https://docs.gitlab.com/ee/administration/custom_hooks.html#setup">Setup</a>ï¼›</p>

<p><strong>åœ¨è¿›è¡Œ push æ“ä½œæ—¶ï¼ŒGitLab ä¼šè°ƒç”¨è¿™ä¸ªé’©å­æ–‡ä»¶ï¼Œå¹¶ä¸”ä» stdin è¾“å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º ä¹‹å‰çš„ç‰ˆæœ¬ commit IDã€push çš„ç‰ˆæœ¬ commit ID å’Œ push çš„åˆ†æ”¯ï¼›æ ¹æ® commit ID æˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾çš„è·å–åˆ°æäº¤ä¿¡æ¯ï¼Œä»è€Œå®ç°è¿›ä¸€æ­¥æ£€æµ‹åŠ¨ä½œï¼›æ ¹æ® GitLab çš„æ–‡æ¡£è¯´æ˜ï¼Œå½“è¿™ä¸ª hook æ‰§è¡Œåä»¥é 0 çŠ¶æ€é€€å‡ºåˆ™è®¤ä¸ºæ‰§è¡Œå¤±è´¥ï¼Œä»è€Œæ‹’ç» pushï¼›åŒæ—¶ä¼šå°† stderr ä¿¡æ¯è¿”å›ç»™ client ç«¯ï¼›</strong>è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸‹é¢å°±å¯ä»¥ç›´æ¥ä¸Šä»£ç äº†ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘å°±ç›´æ¥ç”¨ go é€ äº†ä¸€ä¸ª <a href="https://github.com/mritd/pre-receive">pre-receive</a>ï¼Œå®˜æ–¹æ–‡æ¡£è¯´æ˜äº†ä¸é™åˆ¶è¯­è¨€</p>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"io/ioutil"</span>
    <span class="s">"os"</span>
    <span class="s">"os/exec"</span>
    <span class="s">"regexp"</span>
    <span class="s">"strings"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">CommitType</span> <span class="kt">string</span>

<span class="k">const</span> <span class="p">(</span>
    <span class="n">FEAT</span>     <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"feat"</span>
    <span class="n">FIX</span>      <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"fix"</span>
    <span class="n">DOCS</span>     <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"docs"</span>
    <span class="n">STYLE</span>    <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"style"</span>
    <span class="n">REFACTOR</span> <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"refactor"</span>
    <span class="n">TEST</span>     <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"test"</span>
    <span class="n">CHORE</span>    <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"chore"</span>
    <span class="n">PERF</span>     <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"perf"</span>
    <span class="n">HOTFIX</span>   <span class="n">CommitType</span> <span class="o">=</span> <span class="s">"hotfix"</span>
<span class="p">)</span>
<span class="k">const</span> <span class="n">CommitMessagePattern</span> <span class="o">=</span> <span class="s">`^(?:fixup!\s*)?(\w*)(\(([\w\$\.\*/-].*)\))?\: (.*)|^Merge\ branch(.*)`</span>

<span class="k">const</span> <span class="n">checkFailedMeassge</span> <span class="o">=</span> <span class="s">`##############################################################################
##                                                                          ##
## Commit message style check failed!                                       ##
##                                                                          ##
## Commit message style must satisfy this regular:                          ##
##   ^(?:fixup!\s*)?(\w*)(\(([\w\$\.\*/-].*)\))?\: (. *)|^Merge\ branch(.*) ##
##                                                                          ##
## Example:                                                                 ##
##   feat(test): test commit style check.                                   ##
##                                                                          ##
##############################################################################`</span>

<span class="c">// æ˜¯å¦å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹å°†æ ¡éªŒæ‰€æœ‰çš„æäº¤ä¿¡æ¯æ ¼å¼(å¤š commit ä¸‹)</span>
<span class="k">const</span> <span class="n">strictMode</span> <span class="o">=</span> <span class="no">false</span>

<span class="k">var</span> <span class="n">commitMsgReg</span> <span class="o">=</span> <span class="n">regexp</span><span class="o">.</span><span class="n">MustCompile</span><span class="p">(</span><span class="n">CommitMessagePattern</span><span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">input</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdin</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>

    <span class="c">// allow branch/tag delete</span>
    <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">"0000000000000000000000000000000000000000"</span> <span class="p">{</span>
        <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">commitMsg</span> <span class="o">:=</span> <span class="n">getCommitMsg</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="m">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tmpStr</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">commitMsg</span> <span class="p">{</span>
        <span class="n">commitTypes</span> <span class="o">:=</span> <span class="n">commitMsgReg</span><span class="o">.</span><span class="n">FindAllStringSubmatch</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">,</span> <span class="o">-</span><span class="m">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commitTypes</span><span class="p">)</span> <span class="o">!=</span> <span class="m">1</span> <span class="p">{</span>
            <span class="n">checkFailed</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">commitTypes</span><span class="p">[</span><span class="m">0</span><span class="p">][</span><span class="m">1</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">FEAT</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">FIX</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">DOCS</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">STYLE</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">REFACTOR</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">TEST</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">CHORE</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">PERF</span><span class="p">)</span><span class="o">:</span>
            <span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">HOTFIX</span><span class="p">)</span><span class="o">:</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">if</span> <span class="o">!</span><span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">,</span> <span class="s">"Merge branch"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">checkFailed</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">strictMode</span> <span class="p">{</span>
            <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">func</span> <span class="n">getCommitMsg</span><span class="p">(</span><span class="n">odlCommitID</span><span class="p">,</span> <span class="n">commitID</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">{</span>
    <span class="n">getCommitMsgCmd</span> <span class="o">:=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s">"git"</span><span class="p">,</span> <span class="s">"log"</span><span class="p">,</span> <span class="n">odlCommitID</span><span class="o">+</span><span class="s">".."</span><span class="o">+</span><span class="n">commitID</span><span class="p">,</span> <span class="s">"--pretty=format:%s"</span><span class="p">)</span>
    <span class="n">getCommitMsgCmd</span><span class="o">.</span><span class="n">Stdin</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Stdin</span>
    <span class="n">getCommitMsgCmd</span><span class="o">.</span><span class="n">Stderr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Stderr</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">getCommitMsgCmd</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">commitMsg</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">commitMsg</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">checkFailed</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintln</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="n">checkFailedMeassge</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="ä¸‰å®‰è£…-pre-receive">ä¸‰ã€å®‰è£… pre-receive</h2>

<p>æŠŠä»¥ä¸Šä»£ç ç¼–è¯‘åç”Ÿæˆçš„ <code class="highlighter-rouge">pre-receive</code> æ–‡ä»¶å¤åˆ¶åˆ°å¯¹åº”é¡¹ç›®çš„é’©å­ç›®å½•å³å¯ï¼›<strong>è¦æ³¨æ„çš„æ˜¯æ–‡ä»¶åå¿…é¡»ä¸º <code class="highlighter-rouge">pre-receive</code>ï¼ŒåŒæ—¶ <code class="highlighter-rouge">custom_hooks</code> ç›®å½•éœ€è¦è‡ªå»ºï¼›<code class="highlighter-rouge">custom_hooks</code> ç›®å½•ä»¥åŠ <code class="highlighter-rouge">pre-receive</code> æ–‡ä»¶ç”¨æˆ·ç»„å¿…é¡»ä¸º <code class="highlighter-rouge">git:git</code>ï¼›åœ¨åˆ é™¤åˆ†æ”¯æ—¶ commit ID ä¸º <code class="highlighter-rouge">0000000000000000000000000000000000000000</code>ï¼Œæ­¤æ—¶ä¸éœ€è¦æ£€æµ‹æäº¤ä¿¡æ¯ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ— æ³•åˆ é™¤åˆ†æ”¯/tag</strong>ï¼›æœ€åæ•ˆæœå¦‚ä¸‹æ‰€ç¤º</p>

<p><img src="https://cdn.oss.link/markdown/hs9c2.png" alt="commit msg check" /></p>

<p>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬æ–‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> åè®®æˆæƒ</p>
:ET