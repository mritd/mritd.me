I"<blockquote>
  <p>æœ€è¿‘åœ¨çœ‹ kubeadm çš„æºç ï¼Œä¸è¿‡æœ‰äº›ä¸œè¥¿å…‰çœ‹ä»£ç è¿˜æ˜¯æ²¡æ³•å¤ªæ¸…æ¥šï¼Œè¿˜æ˜¯éœ€è¦å®é™…è¿è¡Œæ‰èƒ½çœ‹åˆ°å…·ä½“ä»£ç æ€ä¹ˆè·‘çš„ï¼Œè¿˜å¾—æ‰“æ–­ç‚¹ debugï¼›æ— å¥ˆçš„æ˜¯æœ¬æœºæ˜¯ macï¼Œdebug å¾—åœ¨ Linux ä¸‹ï¼Œso ç ”ç©¶äº†ä¸€ä¸‹ remote debug</p>
</blockquote>

<h2 id="ä¸€ç¯å¢ƒå‡†å¤‡">ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2>

<ul>
  <li>GoLand 2018.2.4</li>
  <li>Golang 1.11.2</li>
  <li>delve v1.1.0</li>
  <li>Kubernetest master</li>
  <li>Ubuntu 18.04</li>
  <li>èƒ½å¤Ÿé«˜é€Ÿè®¿é—®å¤–ç½‘(è‡ªè¡Œç†è§£)</li>
</ul>

<p><strong>è¿™é‡Œä¸ä¼šè¯¦ç»†å†™å¦‚ä½•å®‰è£… Go å¼€å‘ç¯å¢ƒä»¥åŠ GoLand å®‰è£…ï¼Œæœ¬æ–‡é»˜è®¤è¯»è€…å·²ç»è‡³å°‘å·²ç»å¯¹ Go å¼€å‘ç¯å¢ƒä»¥åŠä»£ç æœ‰ä¸€å®šäº†è§£ï¼›é¡ºä¾¿æä¸€ä¸‹ GoLandï¼Œè¿™ç©æ„å±äº jetbrains ç³»åˆ— IDEï¼Œåœ¨å¤§çº¦ 2018.1 ç‰ˆæœ¬ååœ¨çº¿æ¿€æ´»æœåŠ¡å™¨å·²ç»å…¨éƒ¨å¤±æ•ˆï¼Œä¸è¿‡ç½‘ä¸Šè¿˜æœ‰å…¶ä»–æœ¬åœ°ç¦»çº¿æ¿€æ´»å·¥å…·ï¼Œå…·ä½“è¯·è‡ªè¡Œ Googleï¼Œå¦‚æœåç»­å·¥èµ„èƒ½æ”¯æ’‘å¾—èµ·ï¼Œè¯·è¡¥ç¥¨æ”¯æŒæ­£ç‰ˆ(æ„Ÿæ©èŠ‚å…¨å®¶æ¡¶åŠä»·çœŸé¦™ğŸ˜‚)</strong></p>

<h3 id="11è·å–æºç ">1.1ã€è·å–æºç </h3>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ Kubernetes æºç è™½ç„¶æ‰˜ç®¡åœ¨ Githubï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ <code class="highlighter-rouge">go get</code> çš„æ—¶å€™è¦ä½¿ç”¨ <code class="highlighter-rouge">k8s.io</code> åŸŸå</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go get <span class="nt">-d</span> k8s.io/kubernetes
</code></pre></div></div>

<p><code class="highlighter-rouge">go get</code> å‘½ä»¤æ˜¯æ¥å—æ ‡å‡†çš„ http ä»£ç†çš„ï¼Œè¿™ä¸ªæºç ä¸‹è½½ä¼šéå¸¸æ…¢ï¼Œæºç å¤§çº¦ 1G å·¦å³ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨åŠ é€Ÿå·¥å…·ä¸‹è½½</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âœ  ~ which proxy
/usr/local/bin/proxy
âœ  ~ <span class="nb">cat</span> /usr/local/bin/proxy
<span class="c">#!/bin/bash</span>
<span class="nv">http_proxy</span><span class="o">=</span>http://127.0.0.1:8123 <span class="nv">https_proxy</span><span class="o">=</span>http://127.0.0.1:8123 <span class="nv">$*</span>
âœ  ~ proxy go get <span class="nt">-d</span> k8s.io/kubernetes
</code></pre></div></div>

<h3 id="12å®‰è£…-delve">1.2ã€å®‰è£… delve</h3>

<p>delve æ˜¯ä¸€ä¸ª Golang çš„ debug å·¥å…·ï¼Œæœ‰ç‚¹ç±»ä¼¼ gdbï¼Œä¸è¿‡æ˜¯ä¸“é—¨é’ˆå¯¹ Golang çš„ï¼ŒGoLand çš„ debug å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªå¼€æºå·¥å…·ï¼›ä¸ºäº†è¿›è¡Œè¿œç¨‹ debugï¼Œè¿è¡Œ kubeadm çš„æœºå™¨å¿…é¡»å®‰è£… delveï¼Œä»è€Œè¿›è¡Œè¿œç¨‹è¿æ¥</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># åŒæ ·è¿™é‡Œçœç•¥åœ¨ Linux å®‰è£… go ç¯å¢ƒæ“ä½œ</span>
go get <span class="nt">-u</span> github.com/derekparker/delve/cmd/dlv
</code></pre></div></div>

<h2 id="äºŒè¿œç¨‹-debug">äºŒã€è¿œç¨‹ Debug</h2>

<h3 id="21é‡æ–°ç¼–è¯‘-kubeadm">2.1ã€é‡æ–°ç¼–è¯‘ kubeadm</h3>

<p>é»˜è®¤æƒ…å†µä¸‹ç›´æ¥ç¼–è¯‘å‡ºçš„ kubeadm æ˜¯æ— æ³•è¿›è¡Œ debug çš„ï¼Œå› ä¸º Golang çš„ç¼–è¯‘å™¨ä¼šè¿›è¡Œç¼–è¯‘ä¼˜åŒ–ï¼Œæ¯”å¦‚è¿›è¡Œå†…è”ç­‰ï¼›æ‰€ä»¥è¦å…³é—­ç¼–è¯‘ä¼˜åŒ–å’Œå†…è”ï¼Œæ–¹ä¾¿ debug</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> <span class="k">${</span><span class="nv">GOPATH</span><span class="k">}</span>/src/k8s.io/kubernetes/cmd/kubeadm
<span class="nv">GOOS</span><span class="o">=</span><span class="s2">"linux"</span> <span class="nv">GOARCH</span><span class="o">=</span><span class="s2">"amd64"</span> go build <span class="nt">-gcflags</span> <span class="s2">"all=-N -l"</span>
</code></pre></div></div>

<h3 id="22è¿œç¨‹è¿è¡Œ-kubeadm">2.2ã€è¿œç¨‹è¿è¡Œ kubeadm</h3>

<p>å°†ç¼–è¯‘å¥½çš„ kubeadm å¤åˆ¶åˆ°è¿œç¨‹ï¼Œå¹¶ä¸”ä½¿ç”¨ delve å¯åŠ¨å®ƒï¼Œæ­¤æ—¶ delve ä¼šç›‘å¬ api ç«¯å£ï¼ŒGoLand å°±å¯ä»¥è¿œç¨‹è¿æ¥è¿‡æ¥äº†</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dlv <span class="nt">--listen</span><span class="o">=</span>192.168.1.61:2345 <span class="nt">--headless</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--api-version</span><span class="o">=</span>2 <span class="nb">exec</span> ./kubeadm init
</code></pre></div></div>

<p><strong>æ³¨æ„: è¦æŒ‡å®šéœ€è¦ debug çš„ kubeadm çš„å­å‘½ä»¤ï¼Œå¦åˆ™å¯èƒ½å‡ºç°è¿æ¥ä¸Šä»¥å GoLand æ— ååº”çš„æƒ…å†µ</strong></p>

<h3 id="23è¿è¡Œ-goland">2.3ã€è¿è¡Œ GoLand</h3>

<p>åœ¨ GoLand ä¸­æ‰“å¼€ kubernetes æºç ï¼Œåœ¨éœ€è¦ debug çš„ä»£ç ä¸­æ‰“ä¸Šæ–­ç‚¹ï¼Œè¿™é‡Œä»¥ init å­å‘½ä»¤ä¸ºä¾‹</p>

<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªè¿œç¨‹ debug configuration</p>

<p><img src="https://cdn.oss.link/markdown/i6oed.png" alt="create configuration" /></p>

<p>åå­—å¯ä»¥éšä¾¿å†™ï¼Œä¸»è¦æ˜¯åœ°å€å’Œç«¯å£</p>

<p><img src="https://cdn.oss.link/markdown/rmczj.png" alt="conifg delve" /></p>

<p>æ¥ä¸‹æ¥åœ¨ç›®æ ‡æºç ä½ç½®æ‰“æ–­ç‚¹ï¼Œä»¥ä¸‹ä¸º init å­å‘½ä»¤çš„æºç ä½ç½®</p>

<p><img src="https://cdn.oss.link/markdown/ylf97.png" alt="create breakpoint" /></p>

<p>æœ€ååªéœ€è¦ç‚¹å‡» debug æŒ‰é’®å³å¯</p>

<p><img src="https://cdn.oss.link/markdown/ns2yw.png" alt="debug" /></p>

<p><strong>åœ¨æ²¡æœ‰è¿è¡Œ GoLand debug ä¹‹å‰ï¼Œç›®æ ‡æœºå™¨çš„å®é™…æŒ‡ä»¤æ˜¯ä¸ä¼šè¿è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ GoLand æ²¡æœ‰è¿æ¥åˆ°è¿œç¨‹ delve å¯åŠ¨çš„ <code class="highlighter-rouge">kubeadm init</code> å‘½ä»¤ä¹‹å‰ï¼Œ<code class="highlighter-rouge">kubeadm init</code> å¹¶ä¸ä¼šçœŸæ­£è¿è¡Œï¼›å½“ç‚¹å‡» GoLand çš„ç»ˆæ­¢ debug æŒ‰é’®åï¼Œè¿œç¨‹çš„ delve ä¹Ÿä¼šéšä¹‹é€€å‡º</strong></p>

<p><img src="https://cdn.oss.link/markdown/lmdke.png" alt="stop" /></p>

<p>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬æ–‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> åè®®æˆæƒ</p>
:ET