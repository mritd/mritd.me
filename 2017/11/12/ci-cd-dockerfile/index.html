<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="CI/CD ä¹‹ Dockerfile">
    <meta name="keywords"  content="CI/CD,Dockerfile">
    <meta name="theme-color" content="#000000">
    
    <title>CI/CD ä¹‹ Dockerfile - æ¼ ç„¶çš„åšå®¢ | mritd Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://mritd.me/2017/11/12/ci-cd-dockerfile/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Rouge CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/mritd-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">æ¼ ç„¶</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg.jpg')
    }

    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Linux" title="Linux">Linux</a>
                        
                        <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                        
                        <a class="tag" href="/tags/#Kubernetes" title="Kubernetes">Kubernetes</a>
                        
                    </div>
                    <h1>CI/CD ä¹‹ Dockerfile</h1>
                    
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by æ¼ ç„¶ on November 12, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

                <blockquote>
  <p>æœ€è¿‘å‡†å¤‡æ•´ç†ä¸€ä¸‹å…³äº CI/CD çš„ç›¸å…³æ–‡æ¡£ï¼Œå†™ä¸€ä¸ªå…³äº CI/CD çš„ç³»åˆ—æ–‡ç« ï¼Œè¿™ç¯‡å…ˆä»æœ€åŸºæœ¬çš„ Dockerfile ä¹¦å†™å¼€å§‹ï¼Œæœ¬ç³»åˆ—æ–‡ç« é»˜è®¤è¯»è€…å·²ç»ç†Ÿæ‚‰ Dockerã€Kubernetes ç›¸å…³å·¥å…·</p>
</blockquote>

<h3 id="ä¸€åŸºç¡€é•œåƒé€‰æ‹©">ä¸€ã€åŸºç¡€é•œåƒé€‰æ‹©</h3>

<p>è¿™é‡Œçš„åŸºç¡€é•œåƒæŒ‡çš„æ˜¯å®é™…é¡¹ç›®è¿è¡Œæ—¶çš„åŸºç¡€ç¯å¢ƒé•œåƒï¼Œæ¯”å¦‚ Java çš„ JDK åŸºç¡€é•œåƒã€Nodejs çš„åŸºç¡€é•œåƒç­‰ï¼›åœ¨åˆ¶ä½œé¡¹ç›®çš„åŸºç¡€é•œåƒæ—¶ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºåº”å½“è€ƒè™‘ä¸€ä¸‹å‡ ç‚¹å› ç´ :</p>

<h4 id="11å¯ç»´æŠ¤æ€§">1.1ã€å¯ç»´æŠ¤æ€§</h4>

<p>å¯ç»´æŠ¤æ€§åº”å½“æ”¾åœ¨é¦–è¦ä½ç½®ï¼Œå¦‚æœåœ¨åˆ¶ä½œåŸºç¡€é•œåƒæ—¶ï¼Œé€‰æ‹©äº†ä¸€ä¸ªä½ æ ¹æœ¬ä¸ç†Ÿæ‚‰çš„åŸºç¡€é•œåƒï¼Œæˆ–è€…è¯´ä½ å®Œå…¨ä¸çŸ¥é“è¿™ä¸ªåŸºç¡€é•œåƒé‡Œæœ‰å“ªäº›ç¯å¢ƒå˜é‡ã€Entrypoint è„šæœ¬åšäº†ä»€ä¹ˆæ—¶ï¼Œè¯·æœæ–­æ”¾å¼ƒè¿™ä¸ªåŸºç¡€é•œåƒï¼Œé€‰æ‹©ä¸€ä¸ªä½ è‡ªå·±æ›´åŠ ç†Ÿæ‚‰çš„åŸºç¡€é•œåƒï¼Œä¸è¦ä¸ºä»¥åæŒ–å‘ï¼›è¿˜æœ‰å°±æ˜¯å¦‚æœå¯¹åº”çš„åº”ç”¨å·²ç»æœ‰å®˜æ–¹é•œåƒï¼Œé‚£ä¹ˆå°½é‡é‡‡ç”¨å®˜æ–¹çš„ï¼Œå› ä¸ºä½ å¯ä»¥çœå»ç»´æŠ¤ <strong>è‡ªå·±é€ çš„è½®å­</strong> çš„ç²¾åŠ›ï¼Œ<strong>é™¤éä½ å¯¹åŸºç¡€é•œåƒåˆ¶ä½œå·²ç»å¾—å¿ƒåº”æ‰‹ï¼Œå¦åˆ™è¯·ä¸è¦é€ è½®å­</strong></p>

<h4 id="12ç¨³å®šæ€§">1.2ã€ç¨³å®šæ€§</h4>

<p>åŸºç¡€é•œåƒç¨³å®šæ€§å®é™…ä¸Šæ˜¯ä¸ªå¾ˆå¾®å¦™çš„è¯é¢˜ï¼Œå› ä¸ºæ™®éæ¥è¯´æˆç†Ÿçš„ Linux å‘è¡Œç‰ˆéƒ½å¾ˆç¨³å®šï¼›ä½†æ˜¯å¯¹äºä¸åŒå‘è¡Œç‰ˆé•œåƒä¹‹é—´è¿˜æ˜¯å­˜åœ¨å·®å¼‚çš„ï¼Œæ¯”å¦‚ alpine çš„é•œåƒç”¨çš„æ˜¯ musl libcï¼Œè€Œ debian ç”¨çš„æ˜¯ glibcï¼ŒæŸäº›ä¾èµ– glibc çš„ç¨‹åºå¯èƒ½æ— æ³•åœ¨ alpine ä¸Šå·¥ä½œï¼›alpine ç‰ˆæœ¬çš„ nginx èƒ½ä½¿ç”¨ http2ï¼Œdebian ç‰ˆæœ¬ nginx åˆ™ä¸è¡Œï¼Œå› ä¸º openssl ç‰ˆæœ¬ä¸åŒï¼›ç”šè‡³åœ¨ç›¸åŒå‘è¡Œç‰ˆä¸åŒç‰ˆæœ¬ä¹‹é—´ä¹Ÿä¼šæœ‰å·®å¼‚ï¼Œè­¬å¦‚ openjdk alpine 3.6 ç‰ˆæœ¬ java æŸäº›å›¾å½¢åº“æ— æ³•å·¥ä½œï¼Œåœ¨ alpine edge ä¸Šå®‰è£…æœ€æ–°çš„ openjdk å´æ²¡é—®é¢˜ç­‰ï¼›æ‰€ä»¥ç¨³å®šæ€§è¿™ä¸ªè¯é¢˜å¯¹äºåŸºç¡€é•œåƒè‡ªå·±æ¥è¯´ï¼Œä»–æ°¸è¿œç¨³å®šï¼Œä½†æ˜¯å¯¹äºä½ çš„åº”ç”¨æ¥è¯´ï¼Œåˆ™ä¸åŒåŸºç¡€é•œåƒä¼šäº§ç”Ÿä¸åŒçš„ç¨³å®šæ€§ï¼›<strong>æœ€åï¼Œå¦‚æœä½ å®Œå…¨ç†Ÿæ‚‰ä½ çš„åº”ç”¨ï¼Œç”šè‡³åº”ç”¨å±‚ä»£ç ä¹Ÿæ˜¯ä½ å†™çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ ¹æ®ä½ çš„ä¹ æƒ¯å’Œå–œå¥½å»é€‰æ‹©åŸºç¡€é•œåƒï¼Œå› ä¸ºä½ èƒ½æŠŠæ§åº”ç”¨è¿è¡Œæ—¶ä¾èµ–ï¼›å¦åˆ™çš„è¯ï¼Œè¯·å°½é‡é€‰æ‹© debian è¿™ç§æ¯”è¾ƒæˆç†Ÿçš„å‘è¡Œç‰ˆä½œä¸ºåŸºç¡€é•œåƒï¼Œå› ä¸ºå®ƒåœ¨æ™®éä¸Šå…¼å®¹æ€§æ›´å¥½ä¸€ç‚¹ï¼›è¿˜æœ‰å°½é‡ä¸è¦ä½¿ç”¨ CentOS ä½œä¸ºåŸºç¡€é•œåƒï¼Œå› ä¸ºä»–çš„ä½“ç§¯å°†ä¼šæˆä¸ºå¤§è§„æ¨¡ç½‘ç»œåˆ†å‘ç“¶é¢ˆ</strong></p>

<h4 id="13æ˜“ç”¨æ€§">1.3ã€æ˜“ç”¨æ€§</h4>

<p>æ˜“ç”¨æ€§ç®€å•åœ°è¯´å°±æ˜¯æ˜¯å¦å¯è°ƒè¯•ï¼Œå› ä¸ºæœ‰äº›æç«¯æƒ…å†µä¸‹ï¼Œå¹¶ä¸æ˜¯åº”ç”¨åªè¦è¿è¡Œèµ·æ¥å°±æ²¡äº‹äº†ï¼›å¯èƒ½å‡ºç°ä¸€äº›å¾ˆæ£˜æ‰‹çš„é—®é¢˜éœ€è¦ä½ è¿›å…¥å®¹å™¨è¿›è¡Œè°ƒè¯•ï¼Œæ­¤æ—¶ä½ çš„é•œåƒæ˜“ç”¨æ€§å°±ä¼šä½“ç°å‡ºæ¥ï¼›è­¬å¦‚ä¸€ä¸ª Java é¡¹ç›®ä½ çš„åŸºç¡€é•œåƒæ˜¯ JREï¼Œé‚£ä¹ˆ JDK çš„è°ƒè¯•å·¥å…·å°†å®Œå…¨ä¸å¯ç”¨ï¼Œè¿˜æœ‰å°±æ˜¯å¦‚æœä½ çš„åŸºç¡€é•œåƒé€‰æ‹©äº† alpineï¼Œé‚£ä¹ˆå®ƒé»˜è®¤æ²¡æœ‰ bashï¼Œå¯èƒ½ä½ çš„è„šæœ¬æ— æ³•åœ¨é‡Œé¢å·¥ä½œï¼›<strong>æ‰€æœ‰åœ¨é€‰æ‹©åŸºç¡€é•œåƒçš„æ—¶å€™æœ€å¥½ä¹Ÿè€ƒè™‘ä¸€ä¸‹æœªæ¥æç«¯æƒ…å†µçš„å¯è°ƒè¯•æ€§</strong></p>

<h3 id="äºŒæ ¼å¼åŒ–åŠæ³¨æ„äº‹é¡¹">äºŒã€æ ¼å¼åŒ–åŠæ³¨æ„äº‹é¡¹</h3>

<h4 id="21ä¹¦å†™æ ¼å¼">2.1ã€ä¹¦å†™æ ¼å¼</h4>

<p>Dockerfile ç±»ä¼¼ä¸€å † shell å‘½ä»¤çš„å †ç Œï¼Œå®é™…ä¸Šåœ¨æ„å»ºé˜¶æ®µä¹Ÿå¯ä»¥ç®€å•çš„çœ‹åšæ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼›ä½†æ˜¯ä¸ºäº†æ›´é«˜æ•ˆçš„åˆ©ç”¨ç¼“å­˜å±‚ï¼Œé€šå¸¸éƒ½ä¼šåœ¨ä¸€ä¸ª RUN å‘½ä»¤ä¸­è¿ç»­ä¹¦å†™å¤§é‡çš„è„šæœ¬å‘½ä»¤ï¼Œè¿™æ—¶å€™ä¸€ä¸ªè‰¯å¥½çš„ä¹¦å†™æ ¼å¼å¯ä»¥ä½¿ Dockerfile çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°æ˜“æ‡‚ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åç»´æŠ¤ï¼›æˆ‘ä¸ªäººæ¯”è¾ƒæ¨å´‡çš„æ ¼å¼æ˜¯æŒ‰ç…§ <a href="https://github.com/nginxinc/docker-nginx/blob/master/mainline/alpine/Dockerfile">nginx-alpineå®˜æ–¹ Dockerfile</a> çš„æ ·å¼æ¥ä¹¦å†™ï¼Œè¿™ä¸ª Dockerfile å¤§è‡´åŒ…æ‹¬äº†ä»¥ä¸‹è§„åˆ™:</p>

<ul>
  <li>æ¢è¡Œä»¥ <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> å¼€å¤´ä¿æŒæ¯è¡Œå¯¹é½ï¼Œçœ‹èµ·æ¥å¹²å‡€åˆèˆ’æœ</li>
  <li>å®‰è£…å¤§é‡è½¯ä»¶åŒ…æ—¶ï¼Œæ¯ä¸ªåŒ…ä¸€è¡Œå¹¶æ·»åŠ æ¢è¡Œç¬¦ï¼Œè™½ç„¶ä¼šé€ æˆå¾ˆå¤šè¡Œï¼Œä½†æ˜¯çœ‹èµ·æ¥å¾ˆæ¸…æ™°ï¼›ä¹Ÿå¯æ ¹æ®å®é™…éœ€è¦å¢åŠ æ¯è¡Œè½¯ä»¶åŒ…ä¸ªæ•°ï¼Œä½†æ˜¯å»ºè®®ä¸è¦è¶…è¿‡ 5 ä¸ª</li>
  <li>configure çš„é…ç½®å°½é‡æ”¾åœ¨ç»Ÿä¸€çš„å˜é‡é‡Œï¼Œå¹¶åšå¥½åˆç†æ¢è¡Œï¼Œæ–¹ä¾¿ä»¥åé›†ä¸­åŒ–ä¿®æ”¹</li>
  <li>æ³¨é‡ŠåŒæ ·å’Œå¯¹åº”å‘½ä»¤å¯¹é½ï¼Œå¹¶ä¿æŒå•è¡Œé•¿åº¦ä¸è¶…å‡ºè§†é‡ï¼Œå³ä¸èƒ½é€ æˆæ‹‰åŠ¨æ»šåŠ¨æ¡æ‰èƒ½çœ‹å®Œä½ çš„æ³¨é‡Š</li>
  <li>alpine ä½œä¸ºåŸºç¡€é•œåƒçš„è¯ï¼Œå¿…è¦æ—¶å¯ä»¥ä½¿ç”¨ scanelf æ¥å‡å°‘å®‰è£…ä¾èµ–</li>
</ul>

<p>é™¤äº†ä»¥ä¸Šè§„åˆ™ï¼Œè¯´ä¸‹æˆ‘ä¸ªäººçš„ä¸€äº›å°ä¹ æƒ¯ï¼Œä»…ä¾›å‚è€ƒ:</p>

<ul>
  <li>å½“éœ€è¦ç¼–è¯‘æ—¶ï¼Œå°½é‡é¿å…å¤šæ¬¡ <code class="language-plaintext highlighter-rouge">cd</code> ç›®å½•ï¼Œå¿…é¡»è¿›å…¥ç›®å½•ç¼–è¯‘æ—¶å¯ä»¥å¼€å¯å­ shell ä½¿å…¶å®Œæˆåè¿˜åœç•™ä½†åœ¨å½“å‰ç›®å½•ï¼Œé¿å… <code class="language-plaintext highlighter-rouge">cd</code> è¿›å»å† <code class="language-plaintext highlighter-rouge">cd</code> å›æ¥ï¼Œå¦‚</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>xxxx <span class="se">\</span>
<span class="o">&amp;&amp;</span> ./configure <span class="se">\</span>
<span class="o">&amp;&amp;</span> make <span class="se">\</span>
<span class="o">&amp;&amp;</span> make <span class="nb">install</span> <span class="se">\</span>
<span class="o">&amp;&amp;</span> <span class="nb">cd</span> ../
</code></pre></div></div>
<p>å¯ä»¥å˜ä¸º</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="nb">cd </span>xxx <span class="se">\</span>
<span class="o">&amp;&amp;</span> ./configure <span class="se">\</span>
<span class="o">&amp;&amp;</span> make <span class="se">\</span>
<span class="o">&amp;&amp;</span> make <span class="nb">install</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>åŒæ ·æ„ä¹‰çš„æ“ä½œç»Ÿä¸€æ”¾åœ¨ç›¸é‚»è¡Œå¤„ç†ï¼Œæ¯”å¦‚é•œåƒéœ€è¦å®‰è£…ä¸¤ä¸ªè½¯ä»¶ï¼Œåšä¸¤æ¬¡ <code class="language-plaintext highlighter-rouge">wget</code>ï¼Œé‚£ä¹ˆæ²¡å¿…è¦å®‰è£…å®Œä¸€ä¸ªåˆ é™¤ä¸€ä¸ªå®‰è£…åŒ…ï¼Œå¯ä»¥åœ¨æœ€åç»Ÿä¸€çš„è¿›è¡Œæ¸…ç†åŠ¨ä½œï¼Œç®€è€Œè¨€ä¹‹æ˜¯ <strong>åˆå¹¶å…·æœ‰ç›¸åŒç›®çš„çš„å‘½ä»¤</strong></li>
  <li>å°½é‡ä½¿ç”¨ç½‘ç»œèµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´å°½é‡ä¸è¦åœ¨å½“å‰ç›®å½•ä¸‹æ”¾ç½®é‚£ç§äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œ <code class="language-plaintext highlighter-rouge">ADD</code>/<code class="language-plaintext highlighter-rouge">COPY</code> æ“ä½œï¼Œå› ä¸ºä¸€èˆ¬ Dockerfile éƒ½æ˜¯å­˜æ”¾åˆ° git ä»“åº“çš„ï¼ŒåŒç›®å½•ä¸‹çš„äºŒè¿›åˆ¶å˜åŠ¨ä¼šç»™ git ä»“åº“å¸¦æ¥å¾ˆå¤§è´Ÿæ‹…</li>
  <li>è°ƒæ•´å¥½é•œåƒæ—¶åŒºï¼Œæœ€å¥½å†…ç½®ä¸€ä¸‹ bashï¼Œå¯èƒ½ä»¥åä¸´æ—¶è¿›å…¥å®¹å™¨ä¼šå¤„ç†ä¸€äº›ä¸œè¥¿</li>
  <li><code class="language-plaintext highlighter-rouge">FROM</code> æ—¶æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬å·ï¼Œé˜²æ­¢åç»­å‡çº§æˆ–è€…æ›´æ¢ä¸»æœº build é€ æˆä¸å¯é¢„çŸ¥çš„ç»“æœ</li>
</ul>

<h4 id="22åˆç†åˆ©ç”¨ç¼“å­˜">2.2ã€åˆç†åˆ©ç”¨ç¼“å­˜</h4>

<p>Docker åœ¨ build æˆ–è€…è¯´æ˜¯æ‹‰å–é•œåƒæ—¶æ˜¯ä»¥å±‚ä¸ºå•ä½ä½œä¸ºç¼“å­˜çš„ï¼›é€šä¿—çš„è®²ï¼Œä¸€ä¸ª Dockerfile å‘½ä»¤å°±ä¼šå½¢æˆä¸€ä¸ªé•œåƒå±‚(ä¸ç»å¯¹)ï¼Œå°¤å…¶æ˜¯ <code class="language-plaintext highlighter-rouge">RUN</code> å‘½ä»¤å½¢æˆçš„é•œåƒå±‚å¯èƒ½ä¼šå¾ˆå¤§ï¼›æ­¤æ—¶åº”å½“åˆç†ç»„ç»‡ Dockerfileï¼Œä»¥ä¾¿æ¯æ¬¡æ‹‰å–æˆ–è€… build æ—¶é«˜æ•ˆçš„åˆ©ç”¨ç¼“å­˜å±‚</p>

<ul>
  <li>é‡å¤ build çš„ç¼“å­˜åˆ©ç”¨</li>
</ul>

<p>Docker åœ¨è¿›è¡Œ build æ“ä½œæ—¶ï¼Œå¯¹äºåŒä¸€ä¸ª Dockerfile æ¥è¯´ï¼Œ<strong>åªè¦æ‰§è¡Œè¿‡ä¸€æ¬¡ buildï¼Œé‚£ä¹ˆä¸‹æ¬¡ build å°†ä»å‘½ä»¤æ›´æ”¹å¤„å¼€å§‹</strong>ï¼›ç®€å•çš„ä¾‹å­å¦‚ä¸‹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM alpine:3.6

COPY test.jar /test.jar

RUN apk add openjdk8 <span class="nt">--no-cache</span>

CMD <span class="o">[</span><span class="s2">"java"</span>,<span class="s2">"-jar"</span>,<span class="s2">"/test.tar"</span><span class="o">]</span>
</code></pre></div></div>

<p>å‡è®¾æˆ‘ä»¬çš„é¡¹ç›®å‘å¸ƒç‰©ä¸º <code class="language-plaintext highlighter-rouge">test.jar</code>ï¼Œé‚£ä¹ˆä»¥ä¸Š Dockerfile æ”¾åˆ° CI é‡Œæ¯æ¬¡ build éƒ½ä¼šç›¸å½“æ…¢ï¼ŒåŸå› å°±æ˜¯ <strong>æ¯æ¬¡æ›´æ”¹çš„å‘å¸ƒç‰©ä¸º <code class="language-plaintext highlighter-rouge">test.jar</code>ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯ç›¸å½“äºæ¯æ¬¡ build å¤±æ•ˆä½ç½®ä» <code class="language-plaintext highlighter-rouge">COPY</code> å‘½ä»¤å¼€å§‹ï¼Œè¿™å°†å¯¼è‡´ä¸‹é¢çš„ <code class="language-plaintext highlighter-rouge">RUN</code> å‘½ä»¤æ¯æ¬¡éƒ½ä¼šä¸èµ°ç¼“å­˜é‡å¤æ‰§è¡Œï¼Œå½“ <code class="language-plaintext highlighter-rouge">RUN</code> å‘½ä»¤æ¶‰åŠç½‘ç»œä¸‹è½½ç­‰å¤æ‚åŠ¨ä½œæ—¶è¿™ä¼šæå¤§æ‹–æ…¢ build è¿›åº¦</strong>ï¼Œè§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œç§»åŠ¨ä¸€ä¸‹ <code class="language-plaintext highlighter-rouge">COPY</code> å‘½ä»¤å³å¯</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM alpine:3.6

RUN apk add openjdk8 <span class="nt">--no-cache</span>

COPY test.jar /test.jar

CMD <span class="o">[</span><span class="s2">"java"</span>,<span class="s2">"-jar"</span>,<span class="s2">"/test.tar"</span><span class="o">]</span>
</code></pre></div></div>

<p>æ­¤æ—¶æ¯æ¬¡ build å¤±æ•ˆä½ç½®ä»ç„¶æ˜¯ <code class="language-plaintext highlighter-rouge">COPY</code> å‘½ä»¤ï¼Œä½†æ˜¯ä¸Šé¢çš„ <code class="language-plaintext highlighter-rouge">RUN</code> å‘½ä»¤å±‚å·²ç»è¢« build è¿‡ï¼Œè€Œä¸”æ— ä»»ä½•æ”¹å˜ï¼Œé‚£ä¹ˆæ¯æ¬¡ build æ—¶ <code class="language-plaintext highlighter-rouge">RUN</code> å‘½ä»¤éƒ½ä¼šå‘½ä¸­ç¼“å­˜å±‚ä»è€Œç§’è¿‡</p>

<ul>
  <li>å¤šæ¬¡æ‹‰å–çš„ç¼“å­˜åˆ©ç”¨</li>
</ul>

<p>åŒä¸Šé¢çš„ build ä¸€ä¸ªåŸç†ï¼Œåœ¨ Docker è¿›è¡Œ pull æ“ä½œæ—¶ï¼Œä¹Ÿæ˜¯æŒ‰ç…§é•œåƒå±‚æ¥è¿›è¡Œç¼“å­˜ï¼›å½“é¡¹ç›®è¿›è¡Œæ›´æ–°ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåªè¦å½“å‰ä¸»æœº pull è¿‡ä¸€æ¬¡ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„é¡¹ç›®ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å°†ä¼šç›´æ¥ pull å˜æ›´çš„å±‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šé¢å®‰è£… openjdk çš„å±‚å°†ä¼šå¤ç”¨ï¼›è¿™ç§æƒ…å†µä¸ºäº†çœ‹èµ·æ¥æ¸…æ™°ä¸€ç‚¹ä¹Ÿå¯ä»¥å°† Dockerfile æ‹†åˆ†æˆä¸¤ä¸ª</p>

<p><strong>OpenJDK8 base</strong></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM alpine:3.6

RUN RUN apk add openjdk8 <span class="nt">--no-cache</span>
</code></pre></div></div>

<p><strong>Java Web image</strong></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM xxx.com/base/openjdk8

COPY test.jar /test.jar

CMD <span class="o">[</span><span class="s2">"java"</span>,<span class="s2">"-jar"</span>,<span class="s2">"/test.tar"</span><span class="o">]</span>
</code></pre></div></div>

<h3 id="ä¸‰é•œåƒå®‰å…¨">ä¸‰ã€é•œåƒå®‰å…¨</h3>

<h4 id="31ç”¨æˆ·åˆ‡æ¢">3.1ã€ç”¨æˆ·åˆ‡æ¢</h4>

<p>å½“æˆ‘ä»¬ä¸åœ¨ Dockerfile ä¸­æŒ‡å®šå†…éƒ¨ç”¨æˆ·æ—¶ï¼Œé‚£ä¹ˆé»˜è®¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼›ç”±äº Linux ç³»ç»Ÿæƒé™åˆ¤å®šæ˜¯æ ¹æ® UIDã€GID æ¥è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ <strong>å®¹å™¨é‡Œé¢çš„ root ç”¨æˆ·æœ‰æƒé™è®¿é—®å®¿ä¸»æœº root ç”¨æˆ·çš„ä¸œè¥¿ï¼›æ‰€ä»¥ä¸€æ—¦æŒ‚è½½é”™è¯¯(æ¯”å¦‚å°† <code class="language-plaintext highlighter-rouge">/root/.ssh</code> ç›®å½•æŒ‚è½½è¿›å»)ï¼Œå¹¶ä¸”é‡Œé¢çš„ç”¨æˆ·å…·æœ‰é«˜æƒé™é‚£ä¹ˆå°±å¾ˆå±é™©</strong>ï¼›é€šå¸¸ä¹ æƒ¯æ˜¯éµä»æœ€å°æƒé™åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´å°½é‡ä¿è¯å®¹å™¨é‡Œçš„ç¨‹åºä»¥ä½æƒé™è¿è¡Œï¼Œæ­¤æ—¶å¯ä»¥åœ¨ Dockerfile ä¸­é€šè¿‡ <code class="language-plaintext highlighter-rouge">USER</code> å‘½ä»¤æŒ‡å®šåç»­è¿è¡Œå‘½ä»¤æ‰€ä½¿ç”¨çš„è´¦æˆ·ï¼Œé€šè¿‡ <code class="language-plaintext highlighter-rouge">WORKDIR</code> æŒ‡å®šåç»­å‘½ä»¤åœ¨é‚£ä¸ªç›®å½•ä¸‹æ‰§è¡Œ</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM alpine:3.6

RUN apk add openjdk8 <span class="nt">--no-cache</span>

COPY test.jar /test.jar

USER testuser:testuser

WORKDIR /tmp

CMD <span class="o">[</span><span class="s2">"java"</span>,<span class="s2">"-jar"</span>,<span class="s2">"/test.tar"</span><span class="o">]</span>
</code></pre></div></div>

<p>æœ‰æ—¶ç›´æ¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">USER</code> æŒ‡ä»¤æ¥åˆ‡æ¢ç”¨æˆ·å¹¶ä¸ç®—æ–¹ä¾¿ï¼Œæ¯”å¦‚ä½ çš„é•œåƒéœ€è¦æŒ‚è½½å¤–éƒ¨å­˜å‚¨ï¼Œå¦‚æœå¤–éƒ¨å­˜å‚¨ä¸­æ–‡ä»¶æƒé™è¢«æ„å¤–ä¿®æ”¹ï¼Œä½ çš„ç¨‹åºæ¥ä¸‹æ¥å¯èƒ½å°±ä¼šå¯åŠ¨å¤±è´¥ï¼›æ­¤æ—¶å¯ä»¥ä½¿ç”¨ä¸€ä¸‹ä¸¤ä¸ªå°å·¥å…·æ¥åŠ¨æ€åˆ‡æ¢ç”¨æˆ·ï¼Œå·§å¦™çš„åšæ³•æ˜¯ <strong>åœ¨æ­£å¼è¿è¡Œç¨‹åºä¹‹å‰å…ˆä½¿ç”¨ root ç”¨æˆ·è¿›è¡Œæƒé™ä¿®å¤ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å·¥å…·åˆ‡æ¢åˆ°å…·ä½“ç”¨æˆ·è¿è¡Œ</strong></p>

<ul>
  <li><a href="https://github.com/tianon/gosu">gosu</a> Golang å®ç°çš„ä¸€ä¸ªåˆ‡æ¢ç”¨æˆ·èº«ä»½æ‰§è¡Œå…¶ä»–ç¨‹åºçš„å°å·¥å…·</li>
  <li><a href="https://github.com/hlovdal/su-exec">su-exec</a> C å®ç°çš„ä¸€ä¸ªæ›´è½»é‡çº§çš„ç”¨æˆ·åˆ‡æ¢å·¥å…·</li>
</ul>

<p>å…·ä½“çš„ Dockerfile å¯ä»¥å‚è§æˆ‘å†™çš„ elasticsearch çš„ <a href="https://github.com/mritd/dockerfile/blob/master/elasticsearch/docker-entrypoint.sh">entrypoint è„šæœ¬</a></p>

<h4 id="32å®¹å™¨è¿è¡Œæ—¶">3.2ã€å®¹å™¨è¿è¡Œæ—¶</h4>

<p>å¹¶ä¸æ˜¯æ¯ä¸ªå®¹å™¨éƒ½ä¸€å®šèƒ½åˆ‡æ¢åˆ°ä½æƒé™ç”¨æˆ·æ¥è¿è¡Œçš„ï¼Œå¯èƒ½æŸäº›ç¨‹åºå°±å¸Œæœ›åœ¨ root ä¸‹è¿è¡Œï¼Œæ­¤æ—¶ä¸€å®šè¦ç¡®è®¤å¥½å®¹å™¨æ˜¯å¦éœ€è¦ <strong>ç‰¹æƒæ¨¡å¼</strong> è¿è¡Œï¼›å› ä¸ºä¸€æ—¦å¼€å¯äº†ç‰¹æƒæ¨¡å¼è¿è¡Œçš„å®¹å™¨å°†æœ‰èƒ½åŠ›ä¿®æ”¹å®¿ä¸»æœºå†…æ ¸å‚æ•°ç­‰é‡è¦è®¾ç½®ï¼›å…·ä½“çš„ Docker å®¹å™¨è¿è¡Œè®¾ç½®å‰è¯·å‚è€ƒ <a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">å®˜æ–¹æ–‡æ¡£</a></p>

<p>å…³äº Dockerfile æ–¹é¢æš‚æ—¶æ€»ç»“å‡ºè¿™äº›ï¼Œå¯èƒ½ä¹Ÿä¼šæœ‰é—æ¼ï¼Œå¾…åç»­è¡¥å……å§ï¼›åŒæ—¶æ¬¢è¿å„ä½æå‡ºç›¸å…³ä¿®æ”¹æ„è§ ğŸ˜Š</p>

<p>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬æ–‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> åè®®æˆæƒ</p>


                <hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/11/09/set-up-teleport/" data-toggle="tooltip" data-placement="top" title="Teleport è·³æ¿æœºéƒ¨ç½²">
                        Previous<br>
                        <span>Teleport è·³æ¿æœºéƒ¨ç½²</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/11/14/ohmydocker/" data-toggle="tooltip" data-placement="top" title="ohmydocker é•œåƒåŠ é€Ÿ">
                        Next<br>
                        <span>ohmydocker é•œåƒåŠ é€Ÿ</span>
                        </a>
                    </li>
                    
                </ul>


                
                <!-- disqus è¯„è®ºæ¡† start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus è¯„è®ºæ¡† end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                            
                                <a href="/tags/#Linux" title="Linux" rel="84">
                                    Linux
                                </a>
                            
                        
                            
                                <a href="/tags/#SQL" title="SQL" rel="4">
                                    SQL
                                </a>
                            
                        
                            
                                <a href="/tags/#Java" title="Java" rel="25">
                                    Java
                                </a>
                            
                        
                            
                                <a href="/tags/#éšç¬”" title="éšç¬”" rel="9">
                                    éšç¬”
                                </a>
                            
                        
                            
                                <a href="/tags/#GitHub" title="GitHub" rel="3">
                                    GitHub
                                </a>
                            
                        
                            
                                <a href="/tags/#Docker" title="Docker" rel="44">
                                    Docker
                                </a>
                            
                        
                            
                                <a href="/tags/#Kubernetes" title="Kubernetes" rel="45">
                                    Kubernetes
                                </a>
                            
                        
                            
                                <a href="/tags/#CI/CD" title="CI/CD" rel="4">
                                    CI/CD
                                </a>
                            
                        
                            
                                <a href="/tags/#Golang" title="Golang" rel="7">
                                    Golang
                                </a>
                            
                        
                            
                                <a href="/tags/#Mac" title="Mac" rel="1">
                                    Mac
                                </a>
                            
                        
                            
                                <a href="/tags/#Podman" title="Podman" rel="1">
                                    Podman
                                </a>
                            
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="http://mdba.cn">DBAçš„ç½—æµ®å®«</a></li>
                    
                        <li><a href="http://www.xieyuxuan.cc">è°¢é›¨è½©</a></li>
                    
                        <li><a href="https://ehlxr.me">Ehlxr's Blog</a></li>
                    
                        <li><a href="http://www.dearzd.com/DBlog">å’šé—¨</a></li>
                    
                        <li><a href="http://log.zvz.im">Z</a></li>
                    
                        <li><a href="https://www.4spaces.org">å®¹ä¼‘åšå®¢</a></li>
                    
                        <li><a href="http://www.webank.pw">å¹½é¸¿å±…</a></li>
                    
                        <li><a href="http://ephen.me">Ephen's Blog</a></li>
                    
                        <li><a href="https://www.maoxuner.cn">äºŒæ¬¡å…ƒã®æŠ€æœ¯å®…</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






<!-- disqus å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "mritd";
    var disqus_identifier = "/2017/11/12/ci-cd-dockerfile";
    var disqus_url = "https://mritd.me/2017/11/12/ci-cd-dockerfile/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus å…¬å…±JSä»£ç  end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/mritd1234">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://t.me/mritd">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-telegram fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/mritd">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; æ¼ ç„¶ 2020
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/mritd-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-82387173-1';
    var _gaDomain = 'mritd.me';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if (false) {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->




<!-- Image to hack wechat -->
<img src="/img/avatar.jpg" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
